<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SHM Simulation Lab</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ===== Global ===== */
body { margin: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont; }

/* ===== HOME PAGE ===== */
#home {
  background: #a855f7;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#home h1 span {
  font-size: 100px;
  color: #fff;
  display: inline-block;
  animation: bounce 0.6s ease-in-out infinite alternate;
}

#home h1 span:nth-child(1){animation-delay:0s;}
#home h1 span:nth-child(2){animation-delay:0.1s;}
#home h1 span:nth-child(3){animation-delay:0.2s;}
#home h1 span:nth-child(4){animation-delay:0.3s;}
#home h1 span:nth-child(5){animation-delay:0.4s;}

@keyframes bounce { 0%{transform:translateY(0);} 50%{transform:translateY(-25px);} 100%{transform:translateY(0);} }

#enter {
  margin-top: 40px;
  padding: 14px 36px;
  font-size: 18px;
  border: none;
  cursor: pointer;
  background: #111;
  color: #fff;
  transition: all 0.1s ease-in-out;
  box-shadow: 0 5px #0c0c0c;
  border-radius: 6px;
}

#enter:active {
  transform: translateY(4px);
  box-shadow: 0 1px #0c0c0c;
  background: #222;
}

/* ===== LAB ===== */
#lab { display: none; background: #111; color: #eee; }
h1 { text-align: center; margin: 10px 0; font-weight: 500; }
.container { display: grid; grid-template-columns: 300px 1fr; height: calc(100vh - 50px); }
.controls { padding: 15px; border-right: 1px solid #333; overflow-y: auto; }
.controls h2 { font-size: 16px; margin-top: 15px; border-bottom: 1px solid #333; }
.control { margin: 8px 0; font-size: 13px; }
.control input { width: 100%; }
button { width: 100%; margin-top: 5px; padding: 6px; background: #222; color: #eee; border: 1px solid #444; cursor: pointer; }
button:hover { background: #333; }
.panels { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 10px; padding: 10px; }
canvas { background: #000; border: 1px solid #333; }
#animCanvas { width: 100%; height: 100%; }
.chart-container { width: 100%; height: 100%; }
</style>
</head>
<body>

<!-- ===== HOME ===== -->
<div id="home">
  <h1><span>H</span><span>E</span><span>L</span><span>L</span><span>O</span></h1>
  <button id="enter">Enter Simulation</button>
</div>

<!-- ===== LAB ===== -->
<div id="lab">
<h1>Simple Harmonic Motion Lab</h1>
<div class="container">
  <div class="controls">
    <h2>System Parameters</h2>
    <div class="control">Mass m<input type="range" id="m" min="0.5" max="5" step="0.1" value="1"></div>
    <div class="control">Spring k<input type="range" id="k" min="1" max="50" step="1" value="10"></div>
    <div class="control">Damping c<input type="range" id="c" min="0" max="5" step="0.1" value="0.5"></div>
    <h2>Driving Force</h2>
    <div class="control">Amplitude F₀<input type="range" id="F0" min="0" max="20" step="0.5" value="0"></div>
    <div class="control">Frequency Ω<input type="range" id="Omega" min="0" max="10" step="0.1" value="2"></div>
    <h2>Initial Conditions</h2>
    <div class="control">x₀<input type="range" id="x0" min="-2" max="2" step="0.1" value="1"></div>
    <div class="control">v₀<input type="range" id="v0" min="-5" max="5" step="0.1" value="0"></div>
    <h2>Simulation</h2>
    <div class="control">Time step Δt<input type="range" id="dt" min="0.005" max="0.05" step="0.005" value="0.02"></div>
    <button onclick="paused = !paused">Pause / Resume</button>
    <button onclick="singleStep()">Single Step</button>
    <button onclick="resetSim()">Reset</button>
  </div>

  <div class="panels">
    <canvas id="animCanvas"></canvas>
    <div class="chart-container"><canvas id="xtChart"></canvas></div>
    <div class="chart-container"><canvas id="phaseChart"></canvas></div>
    <div class="chart-container"><canvas id="energyChart"></canvas></div>
  </div>
</div>
</div>

<script>
// 切換首頁 / Lab
document.getElementById("enter").onclick = () => {
  document.getElementById("home").style.display = "none";
  document.getElementById("lab").style.display = "block";
};

// SHM 參數
let x=1, v=0, a=0, t=0, paused=false;
let xtData=[], phaseData=[], energyData=[];
const mEl=document.getElementById("m"), kEl=document.getElementById("k"), cEl=document.getElementById("c");
const F0El=document.getElementById("F0"), OmegaEl=document.getElementById("Omega");
const x0El=document.getElementById("x0"), v0El=document.getElementById("v0"), dtEl=document.getElementById("dt");

// Canvas 動畫
const anim = document.getElementById("animCanvas");
const ctx = anim.getContext("2d");

// Chart.js
const xtChart = new Chart(document.getElementById("xtChart"), {
  type: 'line', data: {datasets:[{label:'x(t)',data:[],borderColor:'#0f0',borderWidth:2,fill:false}]},
  options:{animation:false,responsive:true,scales:{x:{type:'linear',title:{display:true,text:'t'}},y:{title:{display:true,text:'x'}}}}
});
const phaseChart = new Chart(document.getElementById("phaseChart"), {
  type: 'line',
  data: {datasets:[{label:'Phase',data:[],borderColor:'#ff5555',borderWidth:2,fill:false,pointRadius:2}]},
  options:{
    animation:false,responsive:true,
    scales:{
      x:{type:'linear',min:-3,max:3,title:{display:true,text:'x'}},
      y:{min:-5,max:5,title:{display:true,text:'v'}}
    }
  }
});
const energyChart = new Chart(document.getElementById("energyChart"), {
  type: 'line', data: {datasets:[{label:'Energy',data:[],borderColor:'#ffff00',borderWidth:2,fill:false}]},
  options:{animation:false,responsive:true,scales:{x:{type:'linear',title:{display:true,text:'t'}},y:{title:{display:true,text:'E'}}}}
});

// 運算
function acceleration(x,v,t){ return (F0El.value*Math.sin(OmegaEl.value*t)-cEl.value*v-kEl.value*x)/mEl.value; }
function resetSim(){ x=+x0El.value; v=+v0El.value; a=acceleration(x,v,t); t=0; xtData=[]; phaseData=[]; energyData=[]; }
function singleStep(){ step(); updateCharts(); drawAnim(); }
function step(){
  const dtv=+dtEl.value;
  v+=0.5*a*dtv; x+=v*dtv; a=acceleration(x,v,t); v+=0.5*a*dtv; t+=dtv;
}

// 畫彈簧 + 白球
function drawAnim(){
  ctx.clearRect(0,0,anim.width,anim.height);
  const startX=50,startY=anim.height/2,endX=200+x*50,endY=anim.height/2;
  const segs=12;
  ctx.strokeStyle="#888"; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(startX,startY);
  for(let i=1;i<=segs;i++){
    let px=startX+(endX-startX)/segs*i;
    let py=startY+((i%2===0)?5:-5);
    if(i===segs) py=endY;
    ctx.lineTo(px,py);
  }
  ctx.stroke();
  ctx.fillStyle="#fff"; ctx.beginPath(); ctx.arc(endX+20,endY,12,0,Math.PI*2); ctx.fill();
}

// 更新 Chart.js
function updateCharts(){
  xtData.push({x:t,y:x});
  phaseData.push({x:x,y:v});
  energyData.push({x:t,y:0.5*kEl.value*x*x+0.5*mEl.value*v*v});
  if(xtData.length>1000) xtData.shift();
  if(phaseData.length>1000) phaseData.shift();
  if(energyData.length>1000) energyData.shift();
  xtChart.data.datasets[0].data = xtData;
  phaseChart.data.datasets[0].data = phaseData;
  energyChart.data.datasets[0].data = energyData;
  xtChart.update('none'); phaseChart.update('none'); energyChart.update('none');
}

// 主迴圈
function loop(){ if(!paused){ step(); updateCharts(); drawAnim(); } requestAnimationFrame(loop); }
resetSim(); loop();
</script>

</body>
</html>
