<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>SHM Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    height: 100%;
    background: #0b0214;
    color: #e9d5ff;
    font-family: system-ui;
}

.container {
    display: grid;
    grid-template-columns: 3fr 1fr;
    height: 100%;
}

canvas {
    background: #12041f;
    border: 1px solid #3b0764;
}

.left {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 10px;
    padding: 10px;
}

.right {
    padding: 15px;
    border-left: 1px solid #3b0764;
}

label {
    display: block;
    margin-bottom: 15px;
}

input {
    width: 100%;
}
</style>
</head>

<body>

<div class="container">
    <div class="left">
        <canvas id="phase" width="400" height="300"></canvas>
        <canvas id="xt" width="400" height="300"></canvas>
    </div>

    <div class="right">
        <h2>SHM Parameters</h2>
        <label>m <input type="range" min="0.5" max="5" step="0.1" id="m" value="1"></label>
        <label>k <input type="range" min="1" max="30" step="1" id="k" value="10"></label>
        <label>b <input type="range" min="0" max="5" step="0.1" id="b" value="0"></label>
        <button onclick="reset()">Reset</button>
    </div>
</div>

<script>
let x = 1, v = 0, t = 0;
let m = 1, k = 10, b = 0;

const phase = document.getElementById('phase').getContext('2d');
const xt = document.getElementById('xt').getContext('2d');

function a(x, v) {
    return -(k * x + b * v) / m;
}

function step(dt) {
    const a1 = a(x, v);
    x += v * dt + 0.5 * a1 * dt * dt;
    const a2 = a(x, v);
    v += 0.5 * (a1 + a2) * dt;
    t += dt;
}

function draw() {
    phase.fillStyle = 'rgba(18,4,31,0.1)';
    phase.fillRect(0,0,400,300);

    phase.strokeStyle = '#a855f7';
    phase.beginPath();
    phase.arc(200 + x*60, 150 - v*30, 3, 0, Math.PI*2);
    phase.stroke();

    xt.fillStyle = 'rgba(18,4,31,0.1)';
    xt.fillRect(0,0,400,300);
    xt.fillStyle = '#e9d5ff';
    xt.fillRect((t*40)%400, 150 - x*60, 2, 2);
}

let last = performance.now();
let acc = 0;
const dt = 1/120;

function loop(now) {
    acc += (now - last)/1000;
    last = now;

    while (acc > dt) {
        step(dt);
        acc -= dt;
    }

    draw();
    requestAnimationFrame(loop);
}

loop(last);

m.oninput = e => m = +e.target.value;
k.oninput = e => k = +e.target.value;
b.oninput = e => b = +e.target.value;

function reset() {
    x = 1; v = 0; t = 0;
}
</script>

</body>
</html>
