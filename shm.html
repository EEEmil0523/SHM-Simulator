<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHM Lab</title>

<style>
html, body {
    margin: 0;
    height: 100%;
    background: #0b0214;
    color: #e9d5ff;
    font-family: system-ui;
}

.container {
    display: grid;
    grid-template-columns: 3fr 1fr;
    height: 100%;
}

canvas {
    background: #12041f;
    border: 1px solid #3b0764;
    width: 100%;
    height: 100%;
}

.left {
    display: grid;
    grid-template-rows: 1fr 1fr;
    gap: 10px;
    padding: 10px;
}

.right {
    padding: 15px;
    border-left: 1px solid #3b0764;
}

label {
    display: block;
    margin-bottom: 15px;
}

input {
    width: 100%;
}

button {
    padding: 10px;
    background: #a855f7;
    border: none;
    color: white;
    cursor: pointer;
}

a {
    color: #c084fc;
    text-decoration: none;
    display: inline-block;
    margin-top: 15px;
}
</style>
</head>

<body>

<div class="container">
    <div class="left">
        <canvas id="phase"></canvas>
        <canvas id="xt"></canvas>
    </div>

    <div class="right">
        <h2>SHM Parameters</h2>

        <label>m
            <input type="range" min="0.5" max="5" step="0.1" id="m" value="1">
        </label>

        <label>k
            <input type="range" min="1" max="30" step="1" id="k" value="10">
        </label>

        <label>b
            <input type="range" min="0" max="5" step="0.1" id="b" value="0">
        </label>

        <button onclick="reset()">Reset</button>

        <br>
        <a href="index.html">‚Üê Back to Home</a>
    </div>
</div>

<script>
const phase = document.getElementById('phase');
const xt = document.getElementById('xt');
const pctx = phase.getContext('2d');
const xctx = xt.getContext('2d');

function resize() {
    phase.width = phase.clientWidth;
    phase.height = phase.clientHeight;
    xt.width = xt.clientWidth;
    xt.height = xt.clientHeight;
}
window.addEventListener('resize', resize);
resize();

let x = 1, v = 0, t = 0;
let m = 1, k = 10, b = 0;

function accel(x, v) {
    return -(k * x + b * v) / m;
}

function step(dt) {
    const a1 = accel(x, v);
    x += v * dt + 0.5 * a1 * dt * dt;
    const a2 = accel(x, v);
    v += 0.5 * (a1 + a2) * dt;
    t += dt;
}

function draw() {
    pctx.fillStyle = 'rgba(18,4,31,0.15)';
    pctx.fillRect(0, 0, phase.width, phase.height);

    xctx.fillStyle = 'rgba(18,4,31,0.15)';
    xctx.fillRect(0, 0, xt.width, xt.height);

    pctx.fillStyle = '#a855f7';
    pctx.beginPath();
    pctx.arc(
        phase.width / 2 + x * 60,
        phase.height / 2 - v * 30,
        3, 0, Math.PI * 2
    );
    pctx.fill();

    xctx.fillStyle = '#e9d5ff';
    xctx.fillRect(
        (t * 40) % xt.width,
        xt.height / 2 - x * 60,
        2, 2
    );
}

let last = performance.now();
const dt = 1 / 120;

function loop(now) {
    let delta = (now - last) / 1000;
    last = now;

    while (delta > dt) {
        step(dt);
        delta -= dt;
    }

    draw();
    requestAnimationFrame(loop);
}

loop(last);

m.oninput = e => m = +e.target.value;
k.oninput = e => k = +e.target.value;
b.oninput = e => b = +e.target.value;

function reset() {
    x = 1;
    v = 0;
    t = 0;
}
</script>

</body>
</html>
