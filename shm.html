<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>何承蔚好帥</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  height: 100vh;
  background: #0b0214;
  color: #e9d5ff;
  font-family: system-ui;
  display: flex;
}
.container {
  display: flex;
  width: 100%;
  height: 100%;
}
.canvas-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 10px;
}
canvas {
  background: #12041f;
  border: 1px solid #3b0764;
  width: 100%;
  flex: 1;
}
.controls {
  width: 250px;
  padding: 15px;
  border-left: 1px solid #3b0764;
  box-sizing: border-box;
}
.controls h2 {
  margin-top: 0;
}
label {
  display: block;
  margin: 10px 0;
}
input {
  width: 100%;
}
button {
  width: 100%;
  padding: 8px;
  margin-top: 10px;
  background: #222;
  color: #e9d5ff;
  border: 1px solid #444;
  cursor: pointer;
}
button:hover { background: #333; }
#info { margin-top: 10px; text-align: center; }
</style>
</head>
<body>

<div class="container">
  <div class="canvas-container">
    <canvas id="anim"></canvas>
    <canvas id="phase"></canvas>
    <canvas id="xt"></canvas>
  </div>

  <div class="controls">
    <h2>SHM 參數</h2>
    <label>質量 m <input type="range" id="m" min="0.5" max="5" step="0.1" value="1"></label>
    <label>彈簧常數 k <input type="range" id="k" min="1" max="30" step="1" value="10"></label>
    <label>阻尼 b <input type="range" id="b" min="0" max="5" step="0.1" value="0"></label>
    <label>初始位移 x₀ <input type="range" id="x0" min="-2" max="2" step="0.1" value="1"></label>
    <label>初始速度 v₀ <input type="range" id="v0" min="-5" max="5" step="0.1" value="0"></label>
    <button id="enterBtn">ENTER 重置</button>
    <div id="info"></div>
  </div>
</div>

<script>
const canvas = document.getElementById('anim');
const phase = document.getElementById('phase');
const xt = document.getElementById('xt');

const ctx = canvas.getContext('2d');
const pctx = phase.getContext('2d');
const xctx = xt.getContext('2d');

function resizeCanvas() {
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  phase.width = phase.clientWidth;
  phase.height = phase.clientHeight;
  xt.width = xt.clientWidth;
  xt.height = xt.clientHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const mEl = document.getElementById('m');
const kEl = document.getElementById('k');
const bEl = document.getElementById('b');
const x0El = document.getElementById('x0');
const v0El = document.getElementById('v0');
const infoEl = document.getElementById('info');
const enterBtn = document.getElementById('enterBtn');

let x = +x0El.value;
let v = +v0El.value;
let t = 0;
let m = +mEl.value;
let k = +kEl.value;
let b = +bEl.value;
const dt = 1/120;

let historyX = [];
let historyT = [];

function acceleration(x, v) {
    return -(k*x + b*v)/m;
}

function step() {
    const a1 = acceleration(x,v);
    x += v*dt + 0.5*a1*dt*dt;
    const a2 = acceleration(x,v);
    v += 0.5*(a1 + a2)*dt;
    t += dt;

    historyX.push(x);
    historyT.push(t);
    if(historyX.length > xt.width) { historyX.shift(); historyT.shift(); }
}

function drawAnim() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const centerY = canvas.height/2;
    const startX = 100;
    const massX = canvas.width/2 + x*80;

    // 彈簧
    ctx.strokeStyle = '#a855f7';
    ctx.beginPath();
    ctx.moveTo(startX, centerY);
    ctx.lineTo(massX-20, centerY);
    ctx.stroke();

    // 質點
    ctx.fillStyle = '#4aa3ff';
    ctx.beginPath();
    ctx.arc(massX, centerY, 20, 0, Math.PI*2);
    ctx.fill();

    infoEl.innerHTML = `位移 x = ${x.toFixed(2)} m，速度 v = ${v.toFixed(2)} m/s`;
}

function drawPhase() {
    pctx.fillStyle = 'rgba(18,4,31,0.1)';
    pctx.fillRect(0,0,phase.width,phase.height);
    pctx.fillStyle = '#ffcc00';
    const px = phase.width/2 + x*60;
    const py = phase.height/2 - v*30;
    pctx.beginPath();
    pctx.arc(px, py, 3, 0, Math.PI*2);
    pctx.fill();
}

function drawXT() {
    xctx.fillStyle = 'rgba(18,4,31,0.1)';
    xctx.fillRect(0,0,xt.width,xt.height);

    // 歷史軌跡
    xctx.fillStyle = '#e9d5ff';
    historyX.forEach((val,i)=>{
        const px = i;
        const py = xt.height/2 - val*60;
        xctx.fillRect(px, py, 2, 2);
    });

    // 綠點追蹤目前質點
    xctx.fillStyle = '#00ff00';
    const currentX = historyX.length-1;
    const currentY = xt.height/2 - x*60;
    xctx.beginPath();
    xctx.arc(currentX, currentY, 5, 0, Math.PI*2);
    xctx.fill();
}

function loop() {
    step();
    drawAnim();
    drawPhase();
    drawXT();
    requestAnimationFrame(loop);
}

mEl.oninput = e => m = +e.target.value;
kEl.oninput = e => k = +e.target.value;
bEl.oninput = e => b = +e.target.value;
x0El.oninput = e => x = +e.target.value;
v0El.oninput = e => v = +e.target.value;

enterBtn.onclick = () => {
    x = +x0El.value;
    v = +v0El.value;
    t = 0;
    historyX = [];
    historyT = [];
};

loop();
</script>
</body>
</html>
